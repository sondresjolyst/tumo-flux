apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: mysql
  namespace: mysql
spec:
  chart:
    spec:
      version: ${MYSQL_VERSION} # Set in postBuild production
  values:
    primary:
      extraFlags: "--mysql-native-password=ON --character-set-server=UTF8MB4"
      persistence:
        enabled: true
        storageClass: nfs
        size: 8Gi
      livenessProbe:
        enabled: true
        initialDelaySeconds: 360
        periodSeconds: 10
        timeoutSeconds: 5
        failureThreshold: 6
        successThreshold: 1
      readinessProbe:
        enabled: true
        initialDelaySeconds: 360
        periodSeconds: 5
        timeoutSeconds: 3
        failureThreshold: 6
        successThreshold: 1
      # extraVolumes:
      #   - name: config
      #     configMap:
      #       name: mysql-config
      # extraVolumeMounts:
      #   - name: config
      #     mountPath: /opt/bitnami/mysql/conf/
    auth:
      database: grafana
      username: grafana
      createDatabase: true
      existingSecret:
      # authenticationPolicy: caching_sha2_password
